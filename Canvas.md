# Canvas

## 1ã€ğŸ¨åˆè¯†Canvas

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œ**Canvas** æ˜¯ HTML5 æä¾›çš„ä¸€ä¸ªç”¨äºç»˜å›¾çš„å…ƒç´ ï¼Œå¸¸ç”¨äºæ¸²æŸ“å›¾å½¢ã€åŠ¨ç”»ã€æ¸¸æˆã€æ•°æ®å¯è§†åŒ–ç­‰åœºæ™¯ã€‚å®ƒæ˜¯ä¸€ä¸ª **ä½å›¾ç»˜å›¾åŒºåŸŸ**ï¼Œå…è®¸ä½ ä½¿ç”¨ JavaScript åŠ¨æ€åœ°ç»˜åˆ¶åƒç´ çº§çš„å›¾å½¢ã€‚

------

### ğŸ¨ Canvas çš„åŸºæœ¬æ¦‚å¿µï¼š

```html
<canvas id="myCanvas" width="300" height="150"></canvas>
```

- `canvas` æ ‡ç­¾æœ¬èº«åªæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ²¡æœ‰å†…å®¹ã€‚
- ç»˜å›¾æ“ä½œæ˜¯é€šè¿‡ JavaScript å®Œæˆçš„ã€‚
- éœ€è¦ä½¿ç”¨ `getContext()` è·å–ç»˜å›¾ä¸Šä¸‹æ–‡ã€‚

------

### ğŸ“Œ è·å–ä¸Šä¸‹æ–‡å¹¶ç»˜å›¾ç¤ºä¾‹ï¼š

```javascript
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d'); // è·å– 2D ä¸Šä¸‹æ–‡

// ç»˜åˆ¶ä¸€ä¸ªçº¢è‰²çŸ©å½¢
ctx.fillStyle = 'red';
ctx.fillRect(50, 50, 100, 100);
```

------

### ğŸ¯ Canvas çš„ä¸¤ç§ä¸Šä¸‹æ–‡ï¼š

1. `2d`ï¼šäºŒç»´ç»˜å›¾ï¼Œç”¨äºç”»çº¿æ¡ã€çŸ©å½¢ã€åœ†ã€å›¾ç‰‡ç­‰ã€‚
2. `webgl` æˆ– `webgl2`ï¼šä¸‰ç»´ç»˜å›¾ï¼Œç”¨äºé«˜æ€§èƒ½å›¾å½¢æ¸²æŸ“ï¼ˆæ¯”å¦‚æ¸¸æˆã€3D å»ºæ¨¡ï¼‰ã€‚

------

### ğŸ§  Canvas çš„ç‰¹ç‚¹ï¼š

- **åƒç´ çº§æ§åˆ¶**ï¼Œå¯ä»¥å®ç°å¤æ‚å›¾å½¢ã€‚
- **ä¸å…·å¤‡è¯­ä¹‰æ€§**ï¼Œä¸åƒ SVG ä¸­çš„å…ƒç´ å¯ä»¥è¢«å•ç‹¬é€‰ä¸­æˆ–ä¿®æ”¹ã€‚
- **æ€§èƒ½å¥½**ï¼Œé€‚åˆç»˜åˆ¶å¤§é‡å…ƒç´ ï¼ˆå¦‚æ¸¸æˆã€åŠ¨ç”»ç­‰ï¼‰ã€‚
- ä¸æ”¯æŒäº‹ä»¶ç»‘å®šåˆ°ç»˜åˆ¶çš„å›¾å½¢ä¸Šï¼ˆéœ€è¦æ‰‹åŠ¨å¤„ç†ç‚¹å‡»ç­‰äº‹ä»¶ï¼‰ã€‚

------

### ğŸ†š Canvas ä¸ SVG å¯¹æ¯”ï¼š

| ç‰¹æ€§     | Canvas               | SVG                     |
| -------- | -------------------- | ----------------------- |
| æ¸²æŸ“æ–¹å¼ | åƒç´ ï¼ˆä½å›¾ï¼‰ç»˜åˆ¶     | åŸºäº DOM çš„çŸ¢é‡å›¾å½¢     |
| ç¼©æ”¾æ•ˆæœ | æ”¾å¤§ä¼šå¤±çœŸ           | å¯æ— é™ç¼©æ”¾ï¼Œæ¸…æ™°        |
| æ€§èƒ½     | é«˜ï¼Œé€‚åˆå¤æ‚å¤§é‡å…ƒç´  | ä½ï¼Œå…ƒç´ è¶Šå¤šæ€§èƒ½è¶Šå·®    |
| äº¤äº’æ”¯æŒ | éœ€æ‰‹åŠ¨å®ç°           | å¯é€šè¿‡ DOM äº‹ä»¶ç›´æ¥æ”¯æŒ |

------



## 2ã€ğŸ–Œï¸ Canvas çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆContextï¼‰è¯¦è§£

åœ¨ HTML5 Canvas ä¸­ï¼Œè¦æƒ³ç»˜åˆ¶å†…å®¹ï¼Œå¿…é¡»å…ˆé€šè¿‡ JavaScript è·å– Canvas çš„â€œä¸Šä¸‹æ–‡å¯¹è±¡â€ï¼Œå³**ç»˜å›¾ç¯å¢ƒ**ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œå›¾å½¢ç»˜åˆ¶ã€‚

------

### ğŸ“Œ å¸¸è§ä¸‹æ–‡ç±»å‹ï¼š

| ä¸Šä¸‹æ–‡ç±»å‹       | æè¿°                                             | è·å–æ–¹å¼                              |
| ---------------- | ------------------------------------------------ | ------------------------------------- |
| `2d`             | äºŒç»´ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒåŸºæœ¬å›¾å½¢ç»˜åˆ¶ï¼ˆå¦‚çº¿ã€çŸ©å½¢ã€åœ†ç­‰ï¼‰ | `canvas.getContext('2d')`             |
| `webgl`          | ä½¿ç”¨ WebGL 1.0 è¿›è¡Œ 3D å›¾å½¢ç»˜åˆ¶                  | `canvas.getContext('webgl')`          |
| `webgl2`         | ä½¿ç”¨ WebGL 2.0ï¼ˆæ›´å¼ºå¤§çš„ 3D APIï¼‰                | `canvas.getContext('webgl2')`         |
| `bitmaprenderer` | å…è®¸ç›´æ¥æ¸²æŸ“ `ImageBitmap` åˆ° Canvas             | `canvas.getContext('bitmaprenderer')` |
| `webgpu`         | WebGPU æ–°æ ‡å‡†ï¼Œæµè§ˆå™¨æ”¯æŒä»åœ¨å‘å±•ä¸­ï¼ˆå®éªŒæ€§è´¨ï¼‰  | `canvas.getContext('webgpu')`         |

------

### âœ… ä¸‹æ–‡ç”¨é€”ç¤ºä¾‹ï¼š

#### ğŸ“Œ `2d` ä¸Šä¸‹æ–‡ç¤ºä¾‹ï¼š

```javascript
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
ctx.fillStyle = 'green';
ctx.fillRect(10, 10, 100, 100);
```

#### ğŸ“Œ `webgl` ä¸Šä¸‹æ–‡ç¤ºä¾‹ï¼ˆåŸºæœ¬åˆå§‹åŒ–ï¼‰ï¼š

```javascript
const canvas = document.getElementById('myCanvas');
const gl = canvas.getContext('webgl');
if (!gl) {
  console.error('WebGL not supported');
}
```

------

### ğŸŒ æµè§ˆå™¨æ”¯æŒ

| æµè§ˆå™¨          | `2d` æ”¯æŒ | `webgl` æ”¯æŒ  | `webgl2` æ”¯æŒ | `bitmaprenderer` æ”¯æŒ | `webgpu` æ”¯æŒï¼ˆå®éªŒï¼‰ |
| --------------- | --------- | ------------- | ------------- | --------------------- | --------------------- |
| Chrome          | âœ…         | âœ…             | âœ…             | âœ…                     | âœ…ï¼ˆéœ€æ‰‹åŠ¨å¼€å¯ï¼‰       |
| Firefox         | âœ…         | âœ…             | âœ…             | âœ…                     | âœ…ï¼ˆå¼€å‘ç‰ˆæ”¯æŒï¼‰       |
| Safari          | âœ…         | âœ…             | âœ…             | âœ…                     | ğŸš«ï¼ˆéƒ¨åˆ†å®éªŒæ”¯æŒï¼‰     |
| Edge (Chromium) | âœ…         | âœ…             | âœ…             | âœ…                     | âœ…                     |
| Opera           | âœ…         | âœ…             | âœ…             | âœ…                     | âœ…ï¼ˆéœ€è®¾ç½®ï¼‰           |
| ç§»åŠ¨ç«¯æµè§ˆå™¨    | âœ…         | âœ…ï¼ˆå¤šæ•°æ”¯æŒï¼‰ | âœ…ï¼ˆè¾ƒæ–°è®¾å¤‡ï¼‰ | âœ…                     | ğŸš«                     |

------

### ğŸ” å°è´´å£«ï¼š

- å¤§éƒ¨åˆ†å¸¸è§åº”ç”¨åªç”¨ `2d` æˆ– `webgl` å³å¯æ»¡è¶³éœ€æ±‚ã€‚
- `webgpu` æ˜¯ Web å›¾å½¢çš„æ–°ä¸€ä»£æ ‡å‡†ï¼Œæ¯” WebGL æ›´é«˜æ€§èƒ½ï¼Œä½†ä»ä¸ç¨³å®šï¼Œæœªæ¥å€¼å¾—å…³æ³¨ã€‚
- ä½¿ç”¨ `getContext` æ—¶å»ºè®®æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º `null`ï¼Œä»¥é˜²æµè§ˆå™¨ä¸æ”¯æŒè¯¥ä¸Šä¸‹æ–‡ã€‚

------

## 3ã€ğŸ¨ Canvas çš„å¡«å……ä¸è·¯å¾„ç»˜åˆ¶

åœ¨ `Canvas` ä¸­ï¼Œå›¾å½¢çš„ç»˜åˆ¶é€šå¸¸é€šè¿‡â€œè·¯å¾„â€æ¥å®Œæˆã€‚ä½ å¯ä»¥ä½¿ç”¨ `beginPath()` å¼€å§‹ç»˜åˆ¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨å„ç§ç»˜åˆ¶æ–¹æ³•ï¼ˆå¦‚ `moveTo()`ã€`lineTo()`ï¼‰å®šä¹‰è·¯å¾„ï¼Œæœ€åä½¿ç”¨ `fill()` æˆ– `stroke()` æ¸²æŸ“è·¯å¾„ã€‚

------

### ğŸ§± 1. åŸºæœ¬è·¯å¾„æµç¨‹

```javascript
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');

ctx.beginPath();            // å¼€å§‹ä¸€æ¡æ–°è·¯å¾„
ctx.moveTo(50, 50);         // ç§»åŠ¨åˆ°èµ·å§‹ç‚¹
ctx.lineTo(150, 50);        // ç”»ä¸€æ¡çº¿åˆ°æ–°ç‚¹
ctx.lineTo(100, 100);       // å†ç”»ä¸€æ¡çº¿
ctx.closePath();            // å¯é€‰ï¼Œé—­åˆè·¯å¾„ï¼ˆé¦–å°¾è¿æ¥ï¼‰

ctx.fillStyle = 'lightblue'; 
ctx.fill();                 // å¡«å……è·¯å¾„
ctx.strokeStyle = 'blue';   
ctx.stroke();               // æè¾¹è·¯å¾„
```

------

### ğŸ–Œï¸ 2. å¡«å……ä¸æè¾¹å±æ€§

| å±æ€§          | æè¿°                              |
| ------------- | --------------------------------- |
| `fillStyle`   | è®¾ç½®å¡«å……é¢œè‰²ã€æ¸å˜ã€å›¾æ¡ˆ          |
| `strokeStyle` | è®¾ç½®çº¿æ¡é¢œè‰²                      |
| `lineWidth`   | è®¾ç½®æè¾¹å®½åº¦                      |
| `lineJoin`    | è®¾ç½®çº¿è¿æ¥æ–¹å¼ï¼ˆmiterã€roundç­‰ï¼‰  |
| `lineCap`     | è®¾ç½®çº¿æ¡æœ«ç«¯æ ·å¼ï¼ˆbuttã€roundç­‰ï¼‰ |

```javascript
ctx.fillStyle = 'red';
ctx.strokeStyle = 'black';
ctx.lineWidth = 2;
```

------

### ğŸŒ€ 3. ç»˜åˆ¶åŸºæœ¬å›¾å½¢è·¯å¾„ç¤ºä¾‹

#### âœ… åœ†å½¢ï¼ˆä½¿ç”¨ `arc()`ï¼‰ï¼š

```javascript
ctx.beginPath();
ctx.arc(100, 75, 50, 0, Math.PI * 2); // åœ†å¿ƒ(100,75)ï¼ŒåŠå¾„50
ctx.fill();  // å¡«å……åœ†
```

------

#### âœ… çŸ©å½¢ï¼ˆä¹Ÿå¯ç”¨è·¯å¾„æ–¹å¼ï¼‰ï¼š

```javascript
ctx.beginPath();
ctx.rect(20, 20, 100, 50);  // ä»(20,20)å¼€å§‹ï¼Œå®½100é«˜50
ctx.fill();
```

> å½“ç„¶ï¼ŒCanvas æä¾›äº†æ›´ç®€å•çš„çŸ©å½¢æ–¹æ³•ï¼ˆä¸éœ€è·¯å¾„ï¼‰ï¼š

```javascript
ctx.fillRect(20, 20, 100, 50);     // ç«‹å³ç»˜åˆ¶å¡«å……çŸ©å½¢
ctx.strokeRect(20, 20, 100, 50);   // ç«‹å³ç»˜åˆ¶æè¾¹çŸ©å½¢
ctx.clearRect(30, 30, 40, 20);     // æ¸…é™¤åŒºåŸŸ
```

------

### ğŸ§© 4. å¡«å……è§„åˆ™ï¼ˆéé›¶ vs å¥‡å¶ï¼‰

å¯¹äºè‡ªå®šä¹‰å½¢çŠ¶ä¸­æ˜¯å¦éœ€è¦â€œæ´â€ï¼Œå¯ä»¥è®¾ç½®å¡«å……è§„åˆ™ï¼š

```javascript
ctx.fill('evenodd');   // å¥‡å¶è§„åˆ™ï¼Œé€‚ç”¨äºç¯å½¢ã€é•‚ç©ºç­‰
ctx.fill('nonzero');   // é»˜è®¤è§„åˆ™
```

------

ä½ æåˆ°â€œæ¸…æ¥šâ€ï¼Œå¦‚æœæ˜¯æƒ³é—®ï¼š

------

#### 5ã€â“å¦‚ä½•æ¸…é™¤ Canvas çš„å†…å®¹ï¼Ÿ

å¯ä»¥ä½¿ç”¨ Canvas æä¾›çš„ `clearRect()` æ–¹æ³•æ¥æ¸…é™¤ç”»å¸ƒä¸­çš„å†…å®¹ã€‚

âœ… åŸºæœ¬è¯­æ³•ï¼š

```javascript
ctx.clearRect(x, y, width, height);
```

âœ… æ¸…é™¤æ•´ä¸ªç”»å¸ƒï¼š

```javascript
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');

// æ¸…é™¤æ•´ä¸ªç”»å¸ƒ
ctx.clearRect(0, 0, canvas.width, canvas.height);
```

------

ğŸ’¡ è¡¥å……æŠ€å·§ï¼š

1. æ¯å¸§æ¸…é™¤ï¼šç”¨äºåŠ¨ç”»åˆ·æ–°

```javascript
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // å†ç»˜åˆ¶ä¸‹ä¸€å¸§å›¾åƒ
  requestAnimationFrame(draw);
}
draw();
```

2. ä½¿ç”¨ `canvas.width` é‡æ–°èµ‹å€¼ä¹Ÿèƒ½æ¸…ç©ºå†…å®¹ï¼š

```javascript
canvas.width = canvas.width; // ä¼šæ¸…ç©ºå†…å®¹ï¼Œå¹¶é‡ç½®çŠ¶æ€ï¼ˆæ…ç”¨ï¼‰
```

ä½†è¿™ç§æ–¹å¼ä¹Ÿä¼š **æ¸…é™¤æ ·å¼è®¾ç½®ï¼ˆå¦‚ fillStyleï¼‰**ï¼Œä¸å»ºè®®é¢‘ç¹ä½¿ç”¨ã€‚

------

å¦‚æœä½ è¯´çš„â€œæ¸…æ¥šâ€æ˜¯å…¶ä»–æ„æ€ï¼Œä¹Ÿæ¬¢è¿è¡¥å……å…·ä½“é—®é¢˜ï¼Œæˆ‘é©¬ä¸Šä¸ºä½ è§£é‡Šã€‚

### ğŸ’¡ å®æˆ˜å°ä¾‹å­ï¼šç»˜åˆ¶ä¸€ä¸ªäº”è§’æ˜Ÿ

```javascript
function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
  const step = Math.PI / spikes;

  ctx.beginPath();
  for (let i = 0; i < 2 * spikes; i++) {
    const radius = i % 2 === 0 ? outerRadius : innerRadius;
    const angle = i * step - Math.PI / 2;
    const x = cx + Math.cos(angle) * radius;
    const y = cy + Math.sin(angle) * radius;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.closePath();
  ctx.fillStyle = 'gold';
  ctx.fill();
  ctx.strokeStyle = 'black';
  ctx.stroke();
}

drawStar(ctx, 100, 100, 5, 50, 20);
```

------

